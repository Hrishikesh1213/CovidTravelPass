package covid;

import java.io.IOException;
import java.io.PrintWriter;
import java.util.Properties;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;
import javax.mail.*;
import javax.mail.internet.InternetAddress;
import javax.mail.internet.MimeMessage;
import javax.activation.*;

/**
 * Servlet implementation class EmailServlet
 */
@WebServlet("/EmailServlet")
public class EmailServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;
       
    /**
     * @see HttpServlet#HttpServlet()
     */
    public EmailServlet() {
        super();
        
    }

	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
	
		HttpSession session=request.getSession();
		PrintWriter out=response.getWriter();
		
		String recipient = (String) session.getAttribute("emailid");
		String sender = "karra.hrishikesh@gmail.com"; 
	      	String host = "127.0.0.1"; // using host as localhost 
	      Properties properties = System.getProperties(); // Getting system properties  
	      properties.setProperty("mail.smtp.host", host); // Setting up mail server
	      Session ssn = Session.getDefaultInstance(properties); // creating session object to get properties  
	  
	      try 
	      { 
	         
	         MimeMessage message = new MimeMessage(ssn); // MimeMessage object. 
	         message.setFrom(new InternetAddress(sender));  // Set From Field: adding senders email to from field. 
	         message.addRecipient(Message.RecipientType.TO, new InternetAddress(recipient));  // Set To Field: adding recipient's email to from field. 
	         message.setSubject("This is Suject"); // Set Subject: subject of the email 
	         message.setText("This is a test mail");  // set body of the email. 
	         Transport.send(message); // Send email. 
	         out.println("Mail successfully sent"); 
	      } 
	      catch (MessagingException mex)  
	      { 
	         mex.printStackTrace(); 
	      } 
		
	}

}
